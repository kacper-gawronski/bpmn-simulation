<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:flowable="http://flowable.org/bpmn"
             typeLanguage="http://www.w3.org/2001/XMLSchema"
             expressionLanguage="http://www.w3.org/1999/XPath"
             targetNamespace="http://www.flowable.org/processdef">

    <process id="travelRequest" name="Travel Request" isExecutable="true">

                <laneSet>
                    <lane name="Employee">
                        <flowNodeRef>travelRequestSubmittedStart</flowNodeRef>
                        <flowNodeRef>travelAdvanceUnderLimit</flowNodeRef>
                        <flowNodeRef>modifyTravelRequest</flowNodeRef>
                    </lane>
                    <lane name="Manager">
                        <flowNodeRef>validateTravelRequest</flowNodeRef>
                        <flowNodeRef>travelRequestStatus</flowNodeRef>
                        <flowNodeRef>notifyEmployeeOfRejection</flowNodeRef>
                        <flowNodeRef>notifyEmployeeOfApproval</flowNodeRef>
                        <flowNodeRef>validateBooking</flowNodeRef>
                        <flowNodeRef>requestRejectedEnd</flowNodeRef>
                    </lane>
                    <lane name="Planer">
                        <flowNodeRef>prepareBookingInformation</flowNodeRef>
                        <flowNodeRef>bookTicketsAndHotel</flowNodeRef>
                        <flowNodeRef>arrangeTravelAdvance</flowNodeRef>
                        <flowNodeRef>confirmBooking</flowNodeRef>
                        <flowNodeRef>sendMessageToEmployee</flowNodeRef>
                        <flowNodeRef>requestCompletedEnd</flowNodeRef>
                    </lane>
                    <lane name="Accountant">
                        <flowNodeRef>payForTravel</flowNodeRef>
                    </lane>
                </laneSet>

        <startEvent id="travelRequestSubmittedStart" name="Travel request submitted"/>

        <sequenceFlow sourceRef="travelRequestSubmittedStart" targetRef="travelAdvanceUnderLimit"/>

        <exclusiveGateway gatewayDirection="Diverging" id="travelAdvanceUnderLimit" name="Travel advance under limit?"/>

        <sequenceFlow sourceRef="travelAdvanceUnderLimit" targetRef="modifyTravelRequest">
            <conditionExpression>
<!--                ${!travelAdvanceUnderLimit}-->
                ${travelAdvanceUnderLimit == "no"}
            </conditionExpression>
        </sequenceFlow>

        <userTask id="modifyTravelRequest" name="Modify travel request"/>

        <sequenceFlow sourceRef="modifyTravelRequest" targetRef="travelAdvanceUnderLimit"/>

        <sequenceFlow sourceRef="travelAdvanceUnderLimit" targetRef="validateTravelRequest">
            <conditionExpression>
<!--                ${travelAdvanceUnderLimit}-->
                ${travelAdvanceUnderLimit == "yes"}
<!--                ${true}-->
            </conditionExpression>
        </sequenceFlow>

        <userTask id="validateTravelRequest" name="Validate travel request"/>

        <sequenceFlow sourceRef="validateTravelRequest" targetRef="travelRequestStatus"/>

        <exclusiveGateway gatewayDirection="Diverging" id="travelRequestStatus" name="Travel request status?"/>

        <sequenceFlow sourceRef="travelRequestStatus" targetRef="modifyTravelRequest">
            <conditionExpression>
                ${travelRequestStatus == "modify"}
<!--                ${false}-->
            </conditionExpression>
        </sequenceFlow>

        <sequenceFlow sourceRef="travelRequestStatus" targetRef="notifyEmployeeOfRejection">
            <conditionExpression>
                ${travelRequestStatus == "rejected"}
<!--                ${false}-->
            </conditionExpression>
        </sequenceFlow>

        <userTask id="notifyEmployeeOfRejection" name="Notify employee of rejection"/>

        <sequenceFlow sourceRef="notifyEmployeeOfRejection" targetRef="requestRejectedEnd"/>

        <sequenceFlow sourceRef="travelRequestStatus" targetRef="notifyEmployeeOfApproval">
            <conditionExpression>
                ${travelRequestStatus == "approved"}
<!--                ${true}-->
            </conditionExpression>
        </sequenceFlow>

        <userTask id="notifyEmployeeOfApproval" name="Notify employee of approval"/>

        <sequenceFlow sourceRef="notifyEmployeeOfApproval" targetRef="prepareBookingInformation"/>

        <userTask id="prepareBookingInformation" name="Prepare booking information"/>

        <sequenceFlow sourceRef="prepareBookingInformation" targetRef="fork"/>

        <parallelGateway id="fork"/>

        <sequenceFlow sourceRef="fork" targetRef="bookTicketsAndHotel"/>

        <userTask id="bookTicketsAndHotel" name="Book tickets and hotel"/>

        <sequenceFlow sourceRef="bookTicketsAndHotel" targetRef="join"/>

        <sequenceFlow sourceRef="fork" targetRef="arrangeTravelAdvance"/>

        <userTask id="arrangeTravelAdvance" name="Arrange travel advance"/>

        <sequenceFlow sourceRef="arrangeTravelAdvance" targetRef="join"/>

        <parallelGateway id="join"/>

        <sequenceFlow sourceRef="join" targetRef="validateBooking"/>

        <userTask id="validateBooking" name="Validate booking"/>

        <sequenceFlow sourceRef="validateBooking" targetRef="bookingValidationResult"/>

        <exclusiveGateway gatewayDirection="Diverging" id="bookingValidationResult" name="Booking validation result?"/>

        <sequenceFlow sourceRef="bookingValidationResult" targetRef="prepareBookingInformation">
            <conditionExpression>
                ${bookingValidationResultVariable == "modify"}
<!--                ${false}-->
            </conditionExpression>
        </sequenceFlow>

        <sequenceFlow sourceRef="bookingValidationResult" targetRef="requestRejectedEnd">
            <conditionExpression>
                ${bookingValidationResultVariable == "rejected"}
<!--                ${false}-->
            </conditionExpression>
        </sequenceFlow>

        <sequenceFlow sourceRef="bookingValidationResult" targetRef="payForTravel">
            <conditionExpression>
                ${bookingValidationResultVariable == "approved"}
<!--                ${true}-->
            </conditionExpression>
        </sequenceFlow>

        <userTask id="payForTravel" name="Pay for travel"/>

        <sequenceFlow sourceRef="payForTravel" targetRef="confirmBooking"/>

        <userTask id="confirmBooking" name="Confirm booking"/>

        <sequenceFlow sourceRef="confirmBooking" targetRef="sendMessageToEmployee"/>

        <userTask id="sendMessageToEmployee" name="Send message to employee"/>

        <sequenceFlow sourceRef="sendMessageToEmployee" targetRef="requestCompletedEnd"/>


        <endEvent id="requestCompletedEnd" name="Request completed"/>
        <endEvent id="requestRejectedEnd" name="Request rejected"/>

    </process>

</definitions>